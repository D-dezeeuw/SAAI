---
import Layout from '../layouts/Layout.astro';
---

<Layout title="SAAI - Strudel Augmented Artificial Intelligence">
  <!-- Background visualizations (bottom to top: spectrum, scope, pianoroll, shader) -->
  <div class="viz-background">
    <canvas id="spectrum-canvas"></canvas>
    <canvas id="scope-canvas"></canvas>
    <canvas id="pianoroll-canvas"></canvas>
    <canvas id="shader-canvas"></canvas>
  </div>

  <!-- Sticky header -->
  <header class="header">
    <h1 title="Strudel Augmented Artificial Intelligence">SAAI</h1>
    <div class="header-controls">
      <button id="ai-btn" class="active" title="AI Generate">✦</button>
      <button id="code-btn" title="Code Editor" class="active">&lt;/&gt;</button>
      <button id="alter-toggle-btn" title="Alter Code" class="active">⚙</button>
      <span class="header-divider"></span>
      <button id="audio-viz-btn" title="Audio Visualizers" class="active">〰</button>
      <div class="viz-selector">
        <button id="viz-btn" title="Background Effects" class="active">◎</button>
        <div id="viz-dropdown" class="viz-dropdown hidden">
          <button data-viz="none">No vis</button>
          <button data-viz="orbs" class="active">Glowing Orbs</button>
          <button data-viz="stars">Stars</button>
          <button data-viz="trails">Flowing Trails</button>
          <button data-viz="quasar">Quasar</button>
          <button data-viz="oscillo">Oscillo</button>
          <button data-viz="lava">Lava Lamp</button>
        </div>
      </div>
      <span class="header-divider"></span>
      <button id="share-btn" title="Share Code">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/>
          <polyline points="16 6 12 2 8 6"/>
          <line x1="12" y1="2" x2="12" y2="15"/>
        </svg>
      </button>
    </div>
  </header>

  <!-- UI on top -->
  <div class="container">
    <div id="generate-panel" class="generate-panel">
      <div class="input-section">
        <div class="input-group">
          <select id="genre-select">
            <option value="">No genre template</option>
            <option value="edm">EDM / House / Techno</option>
            <option value="dnb">Drum & Bass</option>
            <option value="hiphop-trap">Hip-Hop / Trap</option>
            <option value="acid">Acid</option>
            <option value="jazz">Jazz</option>
          </select>
          <select id="bank-select">
            <option value="" selected>Drum kit</option>
            <option value="RolandTR909">Roland TR-909</option>
            <option value="RolandTR808">Roland TR-808</option>
            <option value="RolandTR707">Roland TR-707</option>
            <option value="LinnDrum">LinnDrum</option>
            <option value="AkaiLinn">Akai Linn</option>
            <option value="KorgM1">Korg M1</option>
            <option value="AlesisHR16">Alesis HR16</option>
          </select>
          <input
            type="text"
            id="prompt-input"
            placeholder="Describe the music you want... (e.g., 'funky drum beat with hi-hats')"
          />
          <button id="generate-btn">Generate</button>
        </div>
      </div>

      <div class="context-section hidden" id="context-section">
        <div class="context-header" id="context-header">
          <span>✦ AI Context</span>
          <span class="context-arrow collapsed" id="context-arrow">▼</span>
        </div>
        <pre id="context-display" class="collapsed"></pre>
      </div>
    </div>

    <div class="code-section">
      <div id="code-editor-container">
        <button id="stop-btn" title="Reset">↺</button>
        <button id="play-btn" title="Play">▶</button>
      </div>
    </div>
    <div class="alter-section">
        <input
          type="text"
          id="alter-input"
          placeholder="Alter: e.g., 'add more reverb', 'make it faster', 'remove hi-hats'..."
        />
        <button id="alter-btn">Go!</button>
        <button id="evolve-btn" title="Auto">✧</button>
        <button id="alter-play-btn" class="alter-play-btn hidden" title="Play/Pause (K)">▶</button>
      </div>

  </div>

  <!-- Bottom-left buttons -->
  <div class="bottom-left-btns">
    <button id="info-btn" class="info-btn" title="Keyboard Shortcuts">
      <span>i</span>
    </button>
    <button id="stats-btn" class="stats-btn" title="Token Usage">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
      </svg>
    </button>
  </div>

  <!-- Shortcuts popup -->
  <div id="shortcuts-popup" class="shortcuts-popup hidden">
    <div class="shortcuts-header">
      <span>Info</span>
      <button id="shortcuts-close" class="shortcuts-close">&times;</button>
    </div>
    <div class="shortcuts-list">
      <span class="shortcuts-header">Keyboard Shortcuts</span>
      <div class="shortcut-item">
        <kbd>K</kbd>
        <span>Play / Stop</span>
      </div>
      <div class="shortcut-item">
        <kbd>H</kbd>
        <span>Hide / Show UI</span>
      </div>
      <div class="shortcut-item">
        <kbd>V</kbd>
        <span>Toggle Visualizers</span>
      </div>
      <div class="shortcut-item">
        <kbd>B</kbd>
        <span>Toggle Background</span>
      </div>
      <div class="shortcut-item">
        <kbd>A</kbd>
        <span>Toggle Visuals Only</span>
      </div>
      <div class="shortcut-item">
        <kbd>&lt;</kbd>
        <span>Previous Background</span>
      </div>
      <div class="shortcut-item">
        <kbd>&gt;</kbd>
        <span>Next Background</span>
      </div>
    </div>
    <div class="shortcuts-footer">
      <span>Dan de Zeeuw - Neko Media</span>
      <a href="https://github.com/D-dezeeuw/SAAI" target="_blank" rel="noopener noreferrer" class="github-link" title="View on GitHub">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
        </svg>
      </a>
    </div>
  </div>

  <!-- Token usage popup -->
  <div id="token-popup" class="token-popup hidden">
    <div class="token-popup-header">
      <span>Token Usage</span>
      <button id="token-popup-close" class="shortcuts-close">&times;</button>
    </div>
    <div class="token-popup-content">
      <div class="token-stat-row">
        <span class="token-stat-label">Input Tokens</span>
        <span id="token-input-display" class="token-stat-value">0</span>
      </div>
      <div class="token-stat-row">
        <span class="token-stat-label">Output Tokens</span>
        <span id="token-output-display" class="token-stat-value">0</span>
      </div>
      <div class="token-stat-row total">
        <span class="token-stat-label">Estimated Cost</span>
        <span id="token-cost-display" class="token-stat-value">$0.0000</span>
      </div>
    </div>
    <div class="token-popup-footer">
      <button id="reset-tokens" class="reset-tokens-btn">Reset Counters</button>
    </div>
  </div>

  <!-- Toast notification -->
  <div id="toast" class="toast hidden">Strudel is inedible :(</div>

  <script>
    import { initApp } from '../lib/initApp';
    initApp();
  </script>
</Layout>
